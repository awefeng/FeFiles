### 大文件上传

https://juejin.cn/post/6844904046436843527#heading-24

要点：

1. 浏览器文件分片：`Blob.prototype.slice`，将大文件拷贝后生成若干个小文件

   ```javascript
   const FILE_CHUNK_SIZE = 10 * 1024 * 1024 // 10M
   const createFileChunk = (file) => {
     const chunkCounts = Math.ceil(file.size/FILE_CHUNK_SIZE)
     let cur = 0, chunks = []
     while(cur < chunkCounts){
   		chunks.push({file: file.slice(FILE_CHUNK_SIZE*cur, FILE_CHUNK_SIZE*(cur+1))})
       cur++
     }
     
     return chunks
   }
   ```

   

2. 上传分片

   ```javascript
   const uploadChunk = (chunk) => {
   	fetch(api, chunk)
   }
   
   const allUpload = async () => {
    return  chunks.map(async chunk => {
   		await uploadCHunk(chunk)
   	})
   }
   
   await Promise.all(allUpload())
   
   ```

   

3. 服务端合并分片：上传分片，每一次请求发送总的分片数量或者所有分片上传完成后发送合并文件请求。

断电续传：

分片后计算文件hash值，将hash值先传入服务端。后面继续上传的时候，先校验哪些文件是传入完整的，浏览器就知道哪些分片上传了哪些没有上传。



### 虚拟列表

https://juejin.cn/post/6877507011769008135

